{"version":3,"file":"rollup-plugin-amd.es.js","sources":["../src/index.js"],"sourcesContent":["import convert from '@buxlabs/amd-to-es6';\nimport { createFilter } from 'rollup-pluginutils';\n\nconst firstpass = /\\b(?:define)\\b/;\nconst importStatement = /\\b(import .*['\"])(.*)(['\"].*\\n)/g;\n\nexport default function(options = {}) {\n    options.converter = options.converter || {};\n    options.converter.sourceMap = options.converter.hasOwnProperty('sourceMap') ? options.converter.sourceMap : true;\n\n    const filter = createFilter( options.include, options.exclude );\n\n    return {\n        name: 'amd',\n\n        transform (code, id) {\n            if ( !filter( id ) ) return;\n            if ( !firstpass.test( code ) ) return;\n\n            let transformed = convert(code, options.converter);\n\n            if (typeof transformed === 'object') {\n                transformed.code = transformed.source;\n                delete transformed.source;\n            }\n\n            if (options.rewire) {\n                if (typeof transformed === 'object') {\n                    transformed.code = transformed.code.replace(importStatement, (match, begin, moduleId, end) => {\n                        return `${begin}${options.rewire(moduleId, id) || moduleId}${end}`;\n                    });\n                } else {\n                    transformed = transformed.replace(importStatement, (match, begin, moduleId, end) => {\n                        return `${begin}${options.rewire(moduleId, id) || moduleId}${end}`;\n                    });\n                }\n            }\n\n            return transformed;\n        }\n    };\n}\n"],"names":["const","let"],"mappings":";;;AAGAA,IAAM,SAAS,GAAG,gBAAgB,CAAC;AACnCA,IAAM,eAAe,GAAG,kCAAkC,CAAC;AAC3D;AACe,eAAS,OAAY,EAAE;qCAAP,GAAG;AAAK;AACvC,IAAI,OAAO,CAAC,SAAS,GAAG,OAAO,CAAC,SAAS,IAAI,EAAE,CAAC;AAChD,IAAI,OAAO,CAAC,SAAS,CAAC,SAAS,GAAG,OAAO,CAAC,SAAS,CAAC,cAAc,CAAC,WAAW,CAAC,GAAG,OAAO,CAAC,SAAS,CAAC,SAAS,GAAG,IAAI,CAAC;AACrH;AACA,IAAIA,IAAM,MAAM,GAAG,YAAY,EAAE,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,EAAE,CAAC;AACpE;AACA,IAAI,OAAO;AACX,QAAQ,IAAI,EAAE,KAAK;AACnB;AACA,QAAQ,6BAAS,EAAE,IAAI,EAAE,EAAE,EAAE;AAC7B,YAAY,KAAK,CAAC,MAAM,EAAE,EAAE,EAAE,KAAG,SAAO;AACxC,YAAY,KAAK,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,KAAG,SAAO;AAClD;AACA,YAAYC,IAAI,WAAW,GAAG,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC;AAC/D;AACA,YAAY,IAAI,OAAO,WAAW,KAAK,QAAQ,EAAE;AACjD,gBAAgB,WAAW,CAAC,IAAI,GAAG,WAAW,CAAC,MAAM,CAAC;AACtD,gBAAgB,OAAO,WAAW,CAAC,MAAM,CAAC;AAC1C,aAAa;AACb;AACA,YAAY,IAAI,OAAO,CAAC,MAAM,EAAE;AAChC,gBAAgB,IAAI,OAAO,WAAW,KAAK,QAAQ,EAAE;AACrD,oBAAoB,WAAW,CAAC,IAAI,GAAG,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,eAAe,YAAG,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,EAAK;AAClH,wBAAwB,aAAU,SAAQ,OAAO,CAAC,MAAM,CAAC,QAAQ,EAAE,EAAE,CAAC,IAAI,YAAW,KAAM;AAC3F,qBAAqB,CAAC,CAAC;AACvB,iBAAiB,MAAM;AACvB,oBAAoB,WAAW,GAAG,WAAW,CAAC,OAAO,CAAC,eAAe,YAAG,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,EAAK;AACxG,wBAAwB,aAAU,SAAQ,OAAO,CAAC,MAAM,CAAC,QAAQ,EAAE,EAAE,CAAC,IAAI,YAAW,KAAM;AAC3F,qBAAqB,CAAC,CAAC;AACvB,iBAAiB;AACjB,aAAa;AACb;AACA,YAAY,OAAO,WAAW,CAAC;AAC/B,SAAS;AACT,KAAK,CAAC;AACN;;;;"}